'use strict'

const escapeHtml = s => String(s)
	.replace(/&/g, '&amp;')
	.replace(/"/g, '&quot;')
	.replace(/'/g, '&#39;')
	.replace(/</g, '&lt;')

const toHtml = o => o != null && o[tgHtml.symbol] || escapeHtml(o)
function toString() { return this[tgHtml.symbol] }

const tgHtml = (raw, ...subs) => Object.freeze({
	[tgHtml.symbol]: String.raw({ raw }, ...subs.map(toHtml)),
	toJSON: toString,
	toString,
})

tgHtml.join = (array, sep=',') =>
	tgHtml([array.map(toHtml).join(toHtml(sep))])

tgHtml.concat = (...s) => tgHtml.join(s, '')

tgHtml.symbol = Symbol('tgHtml.symbol')
Object.freeze(tgHtml)

module.exports = tgHtml
